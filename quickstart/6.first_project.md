## 创建第一个项目
hydra的项目可以通过gaea创建，在创建前请确保安装了gaea,如果还没安装请查阅[gaea工具安装](https://github.com/qxnw/hydra/blob/master/quickstart/3.install_gaea.md)

### 1. 创建项目
现在一切就绪我们就可以创建项目了，打开终端输入命令:`gaea new hydraDemo --service`

```sh
~/work/bin$ gaea new quickstart --service
[2018/03/06 09:19:00.956377][i][3f97ca0bf]启动 gaea ...
[2018/03/06 09:19:00.956497][i][3f97ca0bf]创建文件: /home/yanglei/work/src/hydraDemo/main.go 140
[2018/03/06 09:19:00.956531][i][3f97ca0bf]创建文件: /home/yanglei/work/src/hydraDemo/loader.go 338
[2018/03/06 09:19:00.956594][i][3f97ca0bf]创建文件: /home/yanglei/work/src/hydraDemo/services/order/order.query.go 518
[2018/03/06 09:19:00.956598][i][3f97ca0bf]项目生成成功: /home/yanglei/work/src/hydraDemo
```
```

通过以上命令我们就创建了一个hydra的service项目，通过这个项目编写的代码可运行于http接口，rpc服务，定时任务，job consumer等，项目的目录结构如下:
	
	
	|-- services                    ---服务目录
	|   --order
	|      -- order.query.go
	|-- main.go                     ---程序入口
	|-- loader.go                   ---服务加载

项目文件说明：


|  文件路径  |  说明   |
|:-------:|:-------:|
|main.go|程序入口，初始化，并启动服务器|
|loader.go|服务注册，注册外部服务|
|services|存放所有服务的实现代码|


### 2. 配置服务器运行参数
服务器参数是通过注册中心管理的，注册中心目前只支持zookeeper([安装zookeeper](https://github.com/qxnw/hydra/blob/master/quickstart/4.install_zk.md))，
配置服务器运行参数(端口，路由规则，安全认证等)可以使用hydrd cloud([安装hydrd cloud](https://github.com/qxnw/hydra/blob/master/quickstart/5.install_themis.md))图形界面进行操作，也可以使用zooInspector([安装zooInspector](https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip))手动编写json配置代码

####  使用zooInspector配置服务器参数
1. 启动`zooInspector`输入zookeeper服务器地址
2. 创建服务器配置目录,格式： /<平台名称>/<系统名称>/<服务器类型>/<集群标识>/conf

|名称|说明|
|:------:|:------|
|平台名称|指大的系统或平台，是一组系统的统称|
|系统名称|某个子系统名称，如后台管理系统，前端用户系统等|
|服务器类型|服务器类型，如:api,rpc,web,mqc,cron|
|集群标识|用于控制一组服务，通常指集群名称

我们按如下结构创建一个服务器配置：
   
	|-- myplat
	|     -- quickstart
	|        -- api
	|           -- order-a
	|              -- conf
	|                 --router

我们只需要设置/myplat/quickstart/api/order-a/conf节点和/myplat/quickstart/api/order-a/conf/router节点的值，我们按以下内容设置:

|节点名称|类型|json配置|说明|
|------|------|:------|:-------|
|.../api/order-a/conf|主配置|{"address":":8081","status":"start"}|服务器状态为启动|
|.../api/order-a/conf/router|路由配置|{"routers":[{"name":"/order/query","service":"/order/query"}]}|`name`为外部请求地址，`service`为注册的服务名称|


### 3. 启动服务器
可通过以下两种方式启动服务器：
#### a. 使用hydra直接启动
直接使用hydra启动前请确认项目是否编译为动态库，可在$GOPATH/bin目录下使用命令`go build -buildmode=plugin quickstart`进行编译，然后执行命令:`hydra <平台名称> -r <注册中心地址> -t <配置标识>`

```sh
~/work/bin$ hydra myplat -r "zk://192.168.106.172" -t "171"
[2017/11/01 15:37:45.450110][i][5c0480c14]Listening on http://0.0.0.0:10160
[2017/11/01 15:37:45.456088][i][1e50735ec]Connected to 192.168.106.172:2181
[2017/11/01 15:37:45.458613][i][1e50735ec]Authenticated: id=170788807545718089, timeout=4000
[2017/11/01 15:37:45.458627][i][1e50735ec]Re-submitting `0` credentials after reconnect
[2017/11/01 15:37:46.450214][i][1e50735ec]启动 hydra server(171,zk)...
[2017/11/01 15:37:46.464631][i][1e50735ec]加载引擎插件： ./quickstart.so
[2017/11/01 15:37:46.466433][i][f3a9f5e3b]quickstart(api):http头配置:0
[2017/11/01 15:37:46.467329][i][f3a9f5e3b]quickstart(api):未配置静态文件
[2017/11/01 15:37:46.469052][w][f3a9f5e3b]quickstart(api):未配置metric
[2017/11/01 15:37:46.469066][i][f3a9f5e3b]Listening on http://0.0.0.0:8081
[2017/11/01 15:37:46.969244][i][1e50735ec]启动成功:quickstart(api)(addr:http://192.168.5.71:8081,srvs:1)

```
#### b. 使用`gaea run`命令启动
使用`gaea run`启动服务时无需关注项目是否编译为动态库，因为`gaea`启动时或检测到项目变化后会自动编译项目，执行命令:`gaea run <hydra运行参数> -w <项目路径>`
[了解更多gaea命令](https://github.com/qxnw/hydra/blob/master/quickstart/3.install_gaea.md)

```sh
~/work/bin$ gaea run myplat -r "zk://192.168.106.172" -t "171" -w "quickstart"
[2017/11/01 16:04:55.854413][i][6c86d3023]启动 gaea ...
[2017/11/01 16:04:55.854467][i][6c86d3023]监控项目:/home/my/work/src/quickstart文件的变化...104-2-[run myplat]
[2017/11/01 16:04:55.854758][i][d9a48f203]开始编译hydra...
[2017/11/01 16:04:55.975286][i][d9a48f203]hydra编译成功
[2017/11/01 16:04:55.975323][i][d9a48f203]开始编译/quickstart...
[2017/11/01 16:04:55.975360][i][d9a48f203]结束进程:hydra  [myplat -r zk://192.168.106.172 -t 171 -d]
[2017/11/01 16:05:01.400675][i][d9a48f203]/quickstart 编译成功
[2017/11/01 16:05:01.400733][i][d9a48f203]-------------开始启动hydra-------------
[2017/11/01 16:05:01.411172][i][bf38f8021]Listening on http://0.0.0.0:10160
[2017/11/01 16:05:01.411557][i][c4616c6ec]Connected to 192.168.106.172:2181
[2017/11/01 16:05:01.415275][i][c4616c6ec]Authenticated: id=170788807545718099, timeout=4000
[2017/11/01 16:05:01.415292][i][c4616c6ec]Re-submitting `0` credentials after reconnect
[2017/11/01 16:05:02.411419][i][c4616c6ec]启动 hydra server(171,zk)...
[2017/11/01 16:05:02.431127][i][c4616c6ec]加载引擎插件： ./quickstart.so
[2017/11/01 16:05:02.433125][i][b57103992]quickstart(api):http头配置:0
[2017/11/01 16:05:02.433861][i][b57103992]quickstart(api):未配置静态文件
[2017/11/01 16:05:02.435222][w][b57103992]quickstart(api):未配置metric
[2017/11/01 16:05:02.435245][i][b57103992]Listening on http://0.0.0.0:8081
[2017/11/01 16:05:02.935514][i][c4616c6ec]启动成功:quickstart(api)(addr:http://192.168.5.71:8081,srvs:1)
```

---------------------------



我们看到服务器quickstart(api)已启动成功，外部访问地址是http://192.168.5.71:8081,提供的服务数是1个


### 4. 访问服务
  在终端输入命令访问服务: `curl http://localhost:8081/hello?id=1`
```sh
~/work/bin$ curl http://localhost:8081/hello?id=1
{"id":"1"}

```
返回内容为我们在$GOPATH/src/quickstart/service/myservice.go定义的内容

再看看服务器的执行情况:
```sh
[2017/11/01 15:39:36.566977][i][7f47e7774]api.request: quickstart GET /hello?id=1 from 127.0.0.1
[2017/11/01 15:39:36.567705][i][7f47e7774]---------------业务处理---------------
[2017/11/01 15:39:36.567707][i][7f47e7774]返回结果
[2017/11/01 15:39:36.567754][i][7f47e7774]api.response: quickstart GET /hello?id=1 200 782.097µs

```
其中`api.request` 和 `api.response`两行为服务器自动输出的日志，其它则由业务逻辑自己打印的日志

+ 至此我们使用`gaea`创建了一个简单的service项目，并通过`zooInspector`配置为http接口服务，并通过`hydra`运行起来，使用`curl`成功访问到了这个服务